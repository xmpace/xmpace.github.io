---
layout: post
title: "一些零碎的想法"
excerpt: 一些零碎的想法
background: /img/bg-post.jpg
---

1. 写接口如果不是幂等的，那么就需要做防重复提交的设计。比如转账接口，如果你设计成一个接口实现转账，那么多半就错了，如果这个接口被反复调用，它就会一直转账，显然是不对的。正确的设计应该是转账前先向服务器申请一个转账申请，返回一个单子，然后对这个单子进行支付。（但转账申请也会有幂等问题，如果生成了多个单子呢？也许可以限制同一时间只能有一个可转账的单子，看起来这更像是产品设计上的问题而不是技术问题）

防重复提交设计似乎就是将非幂等的接口想法子设计成幂等的，有待验证。

有时候我们的设计对系统会有一致性要求，这时候我们要区分是强一致性还是顺序一致性还是最终一致性，实现难度是由高到低的，如果设计能够将系统对一致性的要求从强一致性放低到最终一致性，那往往会是个更好的实现。

如果数据与结构分离，那往往会有读性能，需要先读结构，然后批量去拼装数据。